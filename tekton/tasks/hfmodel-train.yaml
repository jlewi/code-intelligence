# A Tekton Task to train a model using hugging face.
#
# Modifications are based on running kpt set 
apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: hfmodel-train
  annotations:
    # This gets passed down to the individual pods
    sidecar.istio.io/inject: "false"
spec:
  params:
  - name: train-image
    type: string
    default: gcr.io/issue-label-bot-dev/hf-trainer:6320d32-dirty@sha256:e150ccf4df2977aedc8c11b60a610824d374a79dfed732b0a481a05a3b989cbb # {"$kpt-set":"hf-trainer-image"}
    description: The docker image to use as the trainer.
  resources:
    inputs:
    - name: source
      type: git
      description: The GitHub repo containing the source code
  steps:
  - name: train
    image: $(inputs.params.train-image)
    env:
    - name: PYTHONPATH
      value: /workspace/$(inputs.resources.source.name)/py
    command:
    - python
    - -m
    - label_microservice.hf_model
    - train
    command:
    - tail
    - -f
    - /dev/null
